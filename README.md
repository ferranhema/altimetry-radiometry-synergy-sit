# Altimetry-Radiometry Synergy for Sea Ice Thickness Retrieval

This repository implements a synergistic methodology for retrieving thin Sea Ice Thickness (SIT) by combining **Active Ku-band Radar Altimetry** (e.g., CryoSat-2) and **Passive L-band Radiometry** (e.g., SMOS/SMAP). The approach integrates physical radiative transfer modeling with machine learning (Random Forest) to constrain dielectric properties and estimate thickness.

## ðŸ“‚ Repository Structure

### 1. Data Processing & Generation
Scripts responsible for co-locating geophysical data and generating training maps.

* **`indexs_regrid.py`**
    * **Function:** Computes nearest-neighbor indices to regrid disparate datasets (TOPAZ, TSURF/CMEMS, SIC) onto the SMOS EASE-Grid. Uses `haversine_distance` to co-locate pixels from different satellite/model grids.
* **`map_generation.py`**
    * **Function:** Generates the `.npy` spatial maps used for training the RF-sit model.
    * **Workflow:**
        1.  Loads regridded geophysical parameters.
        2.  Computes empirical sea ice salinity using `sice_empirical.py`.
        3.  Calculates theoretical permittivity using `ellipsoids_perm.py`.
        4.  **Physics Inversion:** Runs the **Inverse Burke Model** (`d_retrieved_burke_solver_ep`) on every pixel to generate a "reference" thickness based on the physical radiative transfer model.
        5.  Saves a 7-channel `.npy` map containing the reference thickness, radiometric intensity, and physical state variables.

### 2. Machine Learning Modules
Scripts for training the retrieval algorithms (RF-synergy = RF-eps + RF-sit).

* **`rf-eps_training.py`**
    * **Goal:** Train a Random Forest (`RF-eps`) to retrieve **Sea Ice Permittivity** ($\epsilon$) from Altimetry Backscatter.
    * **Method:** Generates a synthetic dataset using the **SMRT (Snow Microwave Radiative Transfer)** model to simulate backscatter ($\sigma^0$) for various ice microstructures (`ellipsoids_perm`) and surface roughness.
    * **Output:** A regressor mapping $[\sigma^0, T_{ice}, S_{ice}] \rightarrow [\epsilon'_{eff}, \epsilon''_{eff}]$.
* **`rf-sit_training.py`**
    * **Goal:** Train a Random Forest (`RF-sit`) to estimate **Sea Ice Thickness**.
    * **Method:** Loads the maps generated by `map_generation.py`. It trains a model to predict the physics-inverted thickness based on radiometric intensity, temperature, salinity, snow presence and permittivity.
    * **Output:** A regressor mapping $[I_{SMOS}, T_{ice}, S_{ice}, Snow, \epsilon] \rightarrow SIT$.

### 3. Physical Models
Underlying physical formulations used for simulations and inversions.

* **`burke_model.py`**
    * **Description:** Implementation of the **Burke et al. (1979)** incoherent radiative transfer model.
    * **Capabilities:**
        * Forward Model (`burke_model_ep`): Computes Brightness Temperature ($T_B$) for 3-layer (Air-Ice-Water) or 4-layer (Air-Snow-Ice-Water) media.
        * Inverse Solver (`d_retrieved_burke_solver_ep`): Retrieves ice thickness given an observed $T_B$.
* **`ellipsoids_perm.py`**
    * **Description:** Computes the effective complex permittivity of sea ice by modeling brine inclusions as ellipsoids.
    * **Formulations:** Supports Maxwell-Garnett, Coherent Potential, and Polder-van Santen mixing formulations.
* **`permittivity_models.py`**
    * **Description:** Empirical dielectric models for **Snow** (density/temperature dependent) and **Sea Water** (Double-Debye model).
* **`sice_empirical.py`**
    * **Description:** Calculates sea ice salinity based on ice thickness and sea water salinity using an empirical exponential formula.

---

## ðŸ”¬ Scientific Workflow

The methodology operates in two main phases:

### Phase 1: Data Preparation & Physics Inversion
Before training, we construct a dataset that bridges observations with physical theory.
1.  **Regridding:** Satellite data (SMOS) and auxiliary models (TOPAZ, CMEMS) are spatially aligned using `indexs_regrid.py`.
2.  **Map Generation:** `map_generation.py` iterates through these aligned grids. For each pixel, it:
    * Derives microstructural parameters (`ellipsoids_perm.py`).
    * Performs a **Burke Model Inversion** (`burke_model.py`) to determine what ice thickness *would* produce the observed SMOS Brightness Temperature given the current physical state.
    * Stores this "physics-derived thickness" as the target variable for the machine learning model.

### Phase 2: Machine Learning Training
1.  **RF-eps (Altimetry Branch):** `rf-eps_training.py` uses SMRT simulations to learn the relationship between active Altimetry backscatter and sea ice permittivity. This allows the system to ingest CryoSat-2 data to constrain the dielectric properties.
2.  **RF-sit (Radiometry Branch):** `rf-sit_training.py` trains the final thickness retrieval model. It learns to predict the thickness (derived in Phase 1) using the synergistic inputs of Radiometry ($T_B$) and the Permittivity derived from Phase 1.

---

### DISCLAIMER
Ensure dependencies are installed. The SMRT model is required for the `rf-eps` simulation.
Install SMRT: [https://github.com/smrt-model/smrt](https://github.com/smrt-model/smrt)